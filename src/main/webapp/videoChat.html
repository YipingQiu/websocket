<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://qiuyiping.oss-cn-beijing.aliyuncs.com/js/jquery-3.2.1.min.js"></script>
</head>
<body>
<video id="video" width="640" height="480" autoplay></video>

</body>
<script>

    var video = document.getElementById("video");
    window.setInterval("console.log(new Date())", 1000);
    $(document).ready(function () {
        var videoObj = {"video": true};
        var errBack = function (error) {
            console.log("Video capture error: ", error.code);
        };
//        if (navigator.webkitGetUserMedia) { // WebKit-prefixed
//            navigator.webkitGetUserMedia(videoObj, function (stream) {
//                console.log(stream);
//                video.src = window.URL.createObjectURL(stream);
//                video.play();
//            }, errBack);
//        } else if (navigator.mozGetUserMedia) { // Firefox-prefixed
//            navigator.mozGetUserMedia(videoObj, function (stream) {
//                video.src = window.URL.createObjectURL(stream);
//                video.play();
//            }, errBack);
//        } else if (navigator.getUserMedia) { // Standard
//            navigator.getUserMedia(videoObj, function (stream) {
//                video.src = stream;
//                video.play();
//            }, errBack);
//        };

        getUserMedia.call(navigator, {
            video: true,
            audio: true
        }, function (stream) {
            g_stream = stream;
        }, function (error) {

        });
        window.setTimeout("yanshi()",1000);

//        upload();
    });

    function yanshi() {
        window.setInterval("upload()", 1000);
    }

    var getUserMedia = navigator.webkitGetUserMedia;
    var g_stream = null;
    var g_recorder = null;
    var chunks = [];

    function stopRecording() {
        if(g_recorder != null){
            g_recorder.stop();
        }
    }

    function startRecording() {
        g_recorder = new MediaRecorder(g_stream, {mimeType: "video/webm"});
        g_recorder.ondataavailable = function (e) {
            chunks.push(e.data);
        };
        g_recorder.onstop = function (e) {
            var blob = new Blob(chunks, {'type': 'video/webm'});
            var audioURL = URL.createObjectURL(blob);
//            vdo.src = audioURL;
            window.open(audioURL);
            var reader = new window.FileReader();
            reader.readAsDataURL(blob);
            reader.onloadend = function () {
                base64data = reader.result;
                console.log(base64data);
            }
        }
        g_recorder.start();
    }

    function upload(){
        console.log(111);
        stopRecording();
        //上传数据
        chunks = [];
        window.setTimeout("startRecording()", 300);
    }
</script>
</html>